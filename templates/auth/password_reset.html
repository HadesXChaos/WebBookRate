{% extends 'base.html' %}
{% load static %}

{% block title %}Đặt lại mật khẩu - BookReview.vn{% endblock %}

{% block content %}
<div class="container" style="max-width: 500px; padding-top: 3rem;">
    <div class="card">
        <div class="card-header" style="text-align: center;">
            <h1>Đặt lại mật khẩu</h1>
            <p style="color: #64748b; margin: 0;">Nhập email của bạn để nhận liên kết đặt lại mật khẩu</p>
        </div>
        <div class="card-body">
            <form id="password-reset-form">
                {% csrf_token %}
                
                <div id="alert-container"></div>
                
                <div class="form-group">
                    <label for="id_email" class="form-label">Email</label>
                    <input type="email" 
                           name="email" 
                           id="id_email" 
                           class="form-input" 
                           placeholder="your@email.com"
                           required
                           autofocus>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Gửi liên kết đặt lại mật khẩu
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
                <p style="color: #64748b;">
                    Nhớ mật khẩu? 
                    <a href="{% url 'login' %}" style="font-weight: 500;">Đăng nhập</a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('password-reset-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const email = formData.get('email');
    const submitButton = this.querySelector('button[type="submit"]');
    const alertContainer = document.getElementById('alert-container');
    
    // Disable button
    submitButton.disabled = true;
    submitButton.textContent = 'Đang gửi...';
    
    try {
        const response = await fetch('/api/auth/password-reset/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': BookReview.utils.getCsrfToken()
            },
            body: JSON.stringify({ email: email })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alertContainer.innerHTML = `
                <div class="alert alert-success" role="alert">
                    <strong>Thành công!</strong> ${result.message}
                </div>
            `;
            this.reset();
        } else {
            alertContainer.innerHTML = `
                <div class="alert alert-error" role="alert">
                    <strong>Lỗi!</strong> ${result.error || result.message || 'Có lỗi xảy ra. Vui lòng thử lại.'}
                </div>
            `;
        }
    } catch (err) {
        console.error('Password reset error:', err);
        alertContainer.innerHTML = `
            <div class="alert alert-error" role="alert">
                <strong>Lỗi!</strong> Có lỗi xảy ra. Vui lòng thử lại.
            </div>
        `;
    } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'Gửi liên kết đặt lại mật khẩu';
    }
});
</script>
{% endblock %}

